{
Price on MA after bars confirmed 
Observed indictor bars and stategy bars need to match to see correct orders otherwise they will mismatch. In this 3 MA and stratgy has 300 bars 

}

inputs: 
	Price( Close ) , 
	FastLength( 50 ),
	SlowLength(200),
	StartTrailingStopPct(20),
	StopLossPct(10),
	ConfirmBars( 1) ;
	
variables: 
	LongCounter( 0 ), SellCounter(0),EnterCondition(false), ExitCondition(false), TrailingStopCondition(false),FastAverage(0), SlowAverage(0),PriceEntered(0);

FastAverage = Average( Price, FastLength );
SlowAverage = Average( Price, SlowLength );

EnterCondition = Price > FastAverage and FastAverage >  SlowAverage; 
ExitCondition =  Price <  SlowAverage and  FastAverage < SlowAverage;

TrailingStopCondition = barssinceentry >1 and StartTrailingStopPct > 0 and Price > PriceEntered*(1+StartTrailingStopPct/100);

if EnterCondition  then 
	LongCounter = LongCounter + 1 
Else 
 	LongCounter = 0;
 	
if ExitCondition  then 
	SellCounter = SellCounter + 1 
else 
	SellCounter = 0;


{ CB > ConfirmBars check used to avoid spurious cross confirmation at 
  CB = ConfirmBars }
if CurrentBar > ConfirmBars and LongCounter >= ConfirmBars then 
	Begin 
	Buy ( !( "MALE1" ) ) next bar at O;
	SellCounter = 0;
	//Setstoploss(Open*StopLossPct/100);
	PriceEntered = Open;
	end;

if ExitCondition then
	Begin
		Sell ( !( "MASL1" ) ) next bar at O;
		LongCounter = 0;
	end;

if( TrailingStopCondition=true) then begin
	Value1 = Price*(1-StartTrailingStopPct/100);
	Value2 = Price-Value1;
	Setstopshare;
	SetDollarTrailing(Value2);
	LongCounter = 0;
	SellCounter = 0;
end;

